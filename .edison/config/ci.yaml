# Edison Project CI Commands (used by templates via {{function:ci_command(...)}})

ci:
  commands:
    # NOTE: Edison currently does not enforce strict static typing across the full codebase.
    # The type-check command is therefore a fast, deterministic syntax check.
    type-check: "UV_CACHE_DIR=.uv-cache uv run python -m compileall src/edison"
    # NOTE: Keep lint non-disruptive until ruff rules are fully adopted repo-wide.
    lint: "UV_CACHE_DIR=.uv-cache uv run python -m compileall src/edison tests"
    format: "UV_CACHE_DIR=.uv-cache uv run ruff format src/ tests/"
    format-check: "UV_CACHE_DIR=.uv-cache uv run ruff format --check src/ tests/"
    # The Edison repo contains large E2E suites; the standard per-task test run
    # focuses on a targeted unit set for fast feedback.
    test: "UV_CACHE_DIR=.uv-cache uv run pytest -q tests/unit/session/test_session_continuation_meta_schema.py tests/unit/config/domains/test_continuation_and_context_window_defaults.py tests/unit/session/next/test_continuation_and_cwam_rules_from_registry.py tests/unit/session/next/test_completion_and_continuation_contract.py tests/unit/opencode/test_opencode_setup_generates_plugin.py tests/unit/cli/session/test_session_continuation_cli.py tests/unit/rules/test_rules_registry_data.py tests/unit/data/rules/test_rule_blocking_flags.py"
    test-fast: "UV_CACHE_DIR=.uv-cache uv run pytest -q tests/unit/session/test_session_continuation_meta_schema.py tests/unit/config/domains/test_continuation_and_context_window_defaults.py tests/unit/session/next/test_continuation_and_cwam_rules_from_registry.py tests/unit/session/next/test_completion_and_continuation_contract.py tests/unit/opencode/test_opencode_setup_generates_plugin.py tests/unit/cli/session/test_session_continuation_cli.py tests/unit/rules/test_rules_registry_data.py tests/unit/data/rules/test_rule_blocking_flags.py"
    test-full: "UV_CACHE_DIR=.uv-cache uv run pytest tests/ -v --tb=short"
    test-coverage: "UV_CACHE_DIR=.uv-cache uv run pytest tests/ --cov=src --cov-report=term-missing"
    build: "UV_CACHE_DIR=.uv-cache uv build -q"
