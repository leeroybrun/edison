<!-- GENERATED BY EDISON - DO NOT EDIT -->
<!-- Source: core -->
<!-- Generated: 2025-12-15T10:49:10.987647 -->
<!-- Regenerate: edison compose constitutions -->

# State Machine

This document is generated from the YAML state machine configuration.
Do not edit manually; update the YAML config and re-run `edison compose`.

## Sources

- workflow.yaml (bundled defaults)

## Diagram

```mermaid
stateDiagram-v2

    state Task {

        todo --> wip

        todo --> done

        todo --> blocked

        wip --> blocked

        wip --> done

        wip --> todo

        wip --> validated

        blocked --> wip

        blocked --> todo

        done --> validated

        done --> wip

    }

    state Qa {

        waiting --> todo

        waiting --> wip

        todo --> wip

        wip --> done

        wip --> todo

        done --> validated

        done --> wip

    }

    state Session {

        draft --> active

        active --> done

        active --> blocked

        active --> closing

        active --> recovery

        blocked --> active

        done --> validated

        closing --> validated

        closing --> recovery

        validated --> archived

        recovery --> active

        recovery --> closing

    }

```

## Domains

## Task Domain

### States

| State | Description | Initial | Final |
| ----- | ----------- | ------- | ----- |

| todo | Task awaiting claim | ✅ |  |

| wip | Task in progress |  |  |

| blocked | Waiting on external blockers |  |  |

| done | Implementation complete, awaiting validation |  |  |

| validated | Validated and complete |  | ✅ |

### Transitions

| From | To | Guard | Conditions | Actions |
| ---- | -- | ----- | ---------- | ------- |

| todo | wip | can_start_task | task_claimed | - |

| todo | done | can_finish_task | all_work_complete; no_pending_commits; no_task_graph_cycles error: Cycle detected in session task graph | record_completion_time |

| todo | blocked | has_blockers | - | record_blocker_reason |

| wip | blocked | has_blockers | - | record_blocker_reason |

| wip | done | can_finish_task | all_work_complete; no_pending_commits; no_task_graph_cycles error: Cycle detected in session task graph | record_completion_time (when: after) |

| wip | todo | always_allow | - | - |

| wip | validated | always_allow | - | - |

| blocked | wip | can_start_task | - | - |

| blocked | todo | always_allow | - | - |

| done | validated | can_finish_task | - | - |

| done | wip | requires_rollback_reason | - | record_blocker_reason (when: after) |

## Qa Domain

### States

| State | Description | Initial | Final |
| ----- | ----------- | ------- | ----- |

| waiting | Pending hand-off from implementation | ✅ |  |

| todo | QA backlog |  |  |

| wip | QA in progress - validators executing |  |  |

| done | QA review complete - awaiting final validation |  |  |

| validated | QA validated - all checks passed |  | ✅ |

### Transitions

| From | To | Guard | Conditions | Actions |
| ---- | -- | ----- | ---------- | ------- |

| waiting | todo | can_start_qa | - | - |

| waiting | wip | can_start_qa | - | - |

| todo | wip | always_allow | - | - |

| wip | done | has_validator_reports | has_required_evidence error: Required evidence files missing (type-check, lint, test, build) | - |

| wip | todo | always_allow | - | - |

| done | validated | can_validate_qa | has_bundle_approval error: Bundle approval required (bundle-approved.json); has_all_waves_passed error: All validator waves must pass in order | - |

| done | wip | always_allow | - | - |

## Session Domain

### States

| State | Description | Initial | Final |
| ----- | ----------- | ------- | ----- |

| draft | Session in draft state, not yet active |  |  |

| active | Session is active, work in progress | ✅ |  |

| blocked | Session blocked due to validation or dependencies |  |  |

| done | Session work complete |  |  |

| closing | Session closing and awaiting validation |  |  |

| validated | Session validated |  |  |

| recovery | Session in recovery after timeout or failure |  |  |

| archived | Session archived |  | ✅ |

### Transitions

| From | To | Guard | Conditions | Actions |
| ---- | -- | ----- | ---------- | ------- |

| draft | active | can_activate_session | has_task error: Session must have a linked task; task_claimed error: Task must be claimed before activating session | validate_prerequisites (when: before); create_worktree (when: config.worktrees_enabled); record_activation_time (when: after); notify_session_start (when: after) |

| active | done | can_complete_session | all_work_complete; no_pending_commits | finalize_session (when: after); record_completion_time (when: after) |

| active | blocked | has_blockers | - | record_blocker_reason |

| active | closing | can_complete_session | ready_to_close | finalize_session |

| active | recovery | always_allow | - | - |

| blocked | active | can_activate_session | blockers_resolved | - |

| done | validated | can_complete_session | - | record_completion_time |

| closing | validated | can_complete_session | ready_to_close; all_tasks_validated | cleanup_worktree (when: config.worktrees_enabled); record_closed (when: after) |

| closing | recovery | always_allow | - | - |

| validated | archived | always_allow | - | - |

| recovery | active | always_allow | - | - |

| recovery | closing | can_complete_session | - | - |