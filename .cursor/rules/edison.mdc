---
description: "Edison Framework Development Rules"
globs: ["**/*.py", "**/*.md", "**/*.yaml", "**/*.yml"]
alwaysApply: true
---

# Edison Framework Rules

## Critical Principles (Non-Negotiable)

1. **STRICT TDD**: Write failing test FIRST (RED), then implement (GREEN), then refactor
2. **NO MOCKS**: Test real behavior, real code, real libs - NO MOCKS EVER
3. **NO LEGACY**: Delete old code completely - NO backward compatibility, NO fallbacks
4. **NO HARDCODED VALUES**: All config from YAML - NO magic numbers/strings in code
5. **100% CONFIGURABLE**: Every behavior must be configurable via YAML
6. **DRY**: Zero code duplication - extract to shared utilities
7. **SOLID**: Single Responsibility, Open/Closed, Liskov Substitution, Interface Segregation, Dependency Inversion
8. **KISS**: Keep It Simple, Stupid - no over-engineering
9. **YAGNI**: You Aren't Gonna Need It - remove speculative features
10. **ROOT CAUSE**: ALWAYS find and fix root causes, never dirty fixes

## Development Practices

- When updating code, ALL related tests should be updated (unit, integration, e2e)
- When a test fails, analyze and fix the ROOT CAUSE - never simplify/skip tests
- Before implementing, search for existing patterns to reuse/extend
- Maintain strict coherence and unity across the codebase

## Testing Guidelines

- Use `tmp_path` fixture for file system tests
- Use SQLite for database tests
- Use real HTTP clients with test servers
- Use pytest fixtures for setup/teardown
- FORBIDDEN: `unittest.mock`, `@patch`, `MagicMock`

<!-- Pack/project extensions go here -->
## Edison Prompt Engineering Rules

**When modifying Edison agents, validators, constitutions, or guidelines**, follow these rules:

## Core Principles (All Roles)

### Single Source of Truth
- Every rule/guideline exists in ONE canonical file
- All other files include from that source via `{{include-section:}}`
- Change in one place propagates everywhere

### No Double-Loading (CRITICAL)
Content appears ONCE. NEVER:
- Include content AND list it as mandatory read
- Copy content instead of including

### Role-Specific Loading
- **Agents**: HOW to implement (TDD execution, code patterns)
- **Validators**: HOW to verify (compliance checks, flags)
- **Orchestrators**: HOW to coordinate (delegation, waves)

Content for other roles MUST NOT be loaded.

### Technology-Agnostic Core
Core agents/validators have ZERO technology content. Packs inject via EXTEND.

### Constitution Embedding
Constitutions are embedded in prompts via `{{include:constitutions/*-base.md}}`.
Single instruction: "Re-read your file on compact" = everything.

### Dynamic Content via Functions
NEVER hardcode states/rosters/versions. Use `{{fn:function_name}}`.

## Anti-Patterns (FORBIDDEN)

### Double-Loading
```markdown
# FORBIDDEN
mandatoryReads: [shared/TDD.md]
{{include:shared/TDD.md}}  # <-- Same content twice!
```

### Technology in Core
```markdown
# FORBIDDEN in core agent
- pytest tests/   # <-- Python-specific!
- pnpm test       # <-- Node-specific!
```

### Hardcoded Dynamic Content
```markdown
# FORBIDDEN
Valid states: todo, wip, done

# CORRECT
Valid states: {{fn:task_states}}
```

### Generic Content in Packs
```markdown
# FORBIDDEN in pack
## TDD Principles      # <-- Generic, belongs in core!
```

### Copying Instead of Including
```markdown
# FORBIDDEN
[50 lines copied from another file]

# CORRECT
{{include-section:path#section}}
```

### Wrong-Role Content
```markdown
# FORBIDDEN in agent
## Validator Wave Orchestration  # <-- Orchestrator-only!
```

## Quality Checklist

Before any prompt change:
- [ ] Content is technology-agnostic (core) or technology-specific (pack)?
- [ ] Content already exists in canonical source?
- [ ] Including correct role-specific section?
- [ ] No double-loading?
- [ ] SECTION markers present for extension?

After changes:
- [ ] `edison compose --all` succeeds
- [ ] No broken includes/sections
- [ ] No duplicate content in composed output
- [ ] Each role loads only their content

**Full Documentation**: `docs/PROMPT_DEVELOPMENT.md`