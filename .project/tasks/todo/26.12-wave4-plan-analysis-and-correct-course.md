---
id: "26.12-wave4-plan-analysis-and-correct-course"
title: "Plan Mode: plan↔tasks↔QA analysis + correct-course workflow (Spec‑Kit analyze + BMAD checklist)"
type: docs
owner:
session_id:
parent_id:
child_ids:
depends_on:
  - "26.8-wave3-plan-generate-tasks"
  - "26.11-wave3-plan-tasks-list-command"
blocks_tasks:
related:
  - "26.7-wave3-plan-spec-validate-and-similarity"
  - "26.9-wave4-slash-commands-and-start-plan-mode"
claimed_at:
last_active:
continuation_id:
created_at: "2025-12-31T00:00:00Z"
updated_at: "2025-12-31T00:00:00Z"
tags:
  - plan-mode
  - commands
  - qa
  - validation
  - docs
priority: high
estimated_hours:
model:
---

# Plan Mode: plan↔tasks↔QA analysis + correct-course workflow (Spec‑Kit analyze + BMAD checklist)

## Summary

Plan Mode needs an explicit “analyze + correct course” workflow, analogous to Spec‑Kit’s `/speckit.analyze`, but tailored to Edison’s Plan→Tasks→QA model.

This task adds plan-focused slash commands that:
- verify coherence across plan spec ↔ generated tasks ↔ QAs
- detect drift and incomplete coverage
- produce a structured findings table (severity rubric, stable IDs, evidence)
- provide a BMAD-style checklist-driven “correct course” workflow for plan changes mid-stream

## Required Reading

- Plan Mode canonical doc: `.project/plans/plan-1-plan-mode.md`
- Optional vendor references (if available; do not block if missing):
  - Spec‑Kit analyze methodology: `spec-kit/templates/commands/analyze.md`
  - BMAD correct-course checklist: `BMAD-METHOD/.../correct-course/checklist.md`
- Existing Edison prompts:
  - `src/edison/data/commands/plan/plan-mode.md`
  - `src/edison/data/commands/task/task-backlog-coherence.md`

## Objectives

- [ ] Add command definition: `src/edison/data/commands/plan/plan-analyze.md` (read-only coherence report).
- [ ] Add command definition: `src/edison/data/commands/plan/plan-correct-course.md` (checklist workflow for plan changes).
- [ ] `plan-analyze` must require deterministic grounding inputs:
  - `edison plan validate <plan-id> --json` (once implemented)
  - `edison plan tasks <plan-id> --json` (once implemented)
  - `edison task waves --json` (for scheduling constraints)
  - `edison task audit --json --tasks-root .project/tasks` (for backlog collision/duplicate signals when relevant)
  - If required commands are missing, halt and report prerequisites.
- [ ] Coherence checks must include:
  - Plan Spec task keys ↔ tasks exist (`plan_id` linkage)
  - Dependency coherence (`depends_on_keys` → concrete `depends_on`)
  - Wave coherence (plan spec wave vs task IDs / wave inference)
  - QA coverage (if `create_qa=true`, each task has a QA record)
  - Drift detection (plan spec changed since last generation; see `generation_history`)
- [ ] Output must include severity rubric and stable finding IDs (Spec‑Kit style).
- [ ] `plan-correct-course` must include explicit halt conditions and a structured checklist (BMAD style):
  - define trigger + evidence
  - assess impact on plan spec, tasks, QA, waves
  - propose a path forward (refine plan, regenerate tasks, or adjust tasks)
  - end with explicit approval gate

## Command Content Requirements (REQUIRED)

Both command definition files MUST be self-contained (an LLM should be able to implement them with no additional context besides the repo), and MUST embed the following vendor-derived methodology:

### From Spec‑Kit analyze
- Strictly read-only by default.
- Progressive disclosure: gather minimum necessary evidence from CLIs first.
- Stable findings IDs and a severity rubric (CRITICAL/HIGH/MEDIUM/LOW).
- Coverage mapping section + metrics (counts, % coverage, unmapped items).
- “Offer remediation, don’t apply” + Ask gate.

### From OpenSpec validate (UX quality bar)
- If a prerequisite CLI fails or required artifact is missing, halt and print:
  - what was missing
  - the exact next command(s) to run
- Prefer `--json` outputs, and treat them as the source of truth.

### From BMAD correct-course checklist
- Checklist-driven workflow with:
  - explicit halt conditions
  - structured sections
  - selection among multiple “path forward” options

## Plan Analyze (required checks + severity guidance)

`plan-analyze` MUST, at minimum, compute and report:

1) **Plan↔Tasks coverage**
   - For every Plan Spec task key: does a generated task exist with matching `plan_id` and key mapping?
   - Severity:
     - CRITICAL: missing task for a Plan Spec key (approved plan cannot be executed)
     - HIGH: tasks exist but dependency mapping is inconsistent

2) **Tasks↔QA coverage**
   - If Plan Spec `create_qa=true` (defaults): ensure each generated task has a QA record.
   - Severity:
     - HIGH: missing QA for a generated task (validation workflow will break)

3) **Dependency coherence**
   - Compare `depends_on_keys` (plan spec) with the concrete `depends_on` chain in tasks.
   - Severity:
     - CRITICAL: required dependency missing
     - MEDIUM: extra dependency present (may be acceptable but should be explained)

4) **Wave / parallelization coherence**
   - Compare Plan Spec wave assignments with computed waves from `edison task waves --json`.
   - Flag tasks that appear in the same wave but have shared locks/file targets suggesting non-parallelism.

5) **Drift detection**
   - If plan has generation history, detect whether current Plan Spec differs from last generated spec.
   - Severity:
     - HIGH: drift detected and tasks were already generated (requires a sync decision)

### Findings table ID scheme (stable)

Use stable prefixes so results are consistent across runs:
- `P*` Plan Spec issues (structure, drift)
- `T*` Task mapping issues (coverage/deps)
- `Q*` QA coverage issues
- `W*` Wave/parallelization issues

## Plan Correct-Course (required checklist structure)

`plan-correct-course` MUST be implemented as a checklist workflow with:
- Section 1: Trigger + evidence (halt if unclear)
- Section 2: Impact assessment across plan/tasks/QA/waves
- Section 3: Options evaluation (at least 3 options) with risk/effort
- Section 4: Selected path forward + explicit approval gate

## Output Format (STRICT)

For `plan-analyze`:
- Executive summary + metrics (coverage %, drift flags)
- Findings table: `ID`, `Category`, `Severity`, `Evidence`, `Recommendation`
- Ask gate (approval required before suggesting edits)

For `plan-correct-course`:
- Checklist sections with item IDs and `[ ] Done / [ ] N/A / [ ] Action-needed`
- Halt conditions when prerequisites are missing
- Final “Chosen path forward” + Ask gate

## Acceptance Criteria

- [ ] The plan analysis workflow is as structured and reusable as Spec‑Kit analyze.
- [ ] Correct-course workflow is explicitly checklist-driven and halts when missing evidence.
- [ ] All outputs are read-only by default and require approval for any edits.
- [ ] `plan-analyze` defines explicit severity rules and stable ID scheme so two different LLMs produce comparable reports.

## Files to Create/Modify

```
# Add
src/edison/data/commands/plan/plan-analyze.md
src/edison/data/commands/plan/plan-correct-course.md
```
