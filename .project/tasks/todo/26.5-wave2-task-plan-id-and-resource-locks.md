---
id: "26.5-wave2-task-plan-id-and-resource-locks"
title: "Extend tasks: plan_id link + resource_locks (soft non-parallelism)"
type: feature
owner:
session_id:
parent_id:
child_ids:
depends_on:
  - "26.2-wave1-plan-domain-core"
blocks_tasks:
related:
  - "26.1-wave1-meta-share-plans"
claimed_at:
last_active:
continuation_id:
created_at: "2025-12-28T00:00:00Z"
updated_at: "2025-12-28T00:00:00Z"
tags:
  - plan-mode
  - tasks
priority: high
estimated_hours:
model:
---

# Extend tasks: plan_id link + resource_locks (soft non-parallelism)

## Summary

Add two new task frontmatter fields to support Plan Mode and better orchestration:
- `plan_id`: links a task to its originating plan (QA infers plan via task).
- `resource_locks`: soft “should not run concurrently” constraints (used by planner batching).

This must be implemented in the Task model + repository serialization/parsing so it is stable across saves/transitions.

## Required Reading

- `.project/plans/plan-1-plan-mode.md`
- `src/edison/core/task/models.py`
- `src/edison/core/task/repository.py` (`_task_to_markdown`, `_parse_task_markdown`)
- `src/edison/core/task/index.py` (TaskSummary scanning)

## Objectives

- [ ] Add `plan_id: Optional[str]` and `resource_locks: list[str]` to `Task`.
- [ ] Serialize/parse those fields in TaskRepository.
- [ ] Ensure TaskIndex/TaskSummary extracts them (if needed for planning output).
- [ ] Add tests ensuring values round-trip and survive `repo.save(...)`.

## Acceptance Criteria

- [ ] A task saved with `plan_id` and `resource_locks` preserves them on disk.
- [ ] A task loaded from disk exposes both fields with correct types.
- [ ] Existing task behavior remains unchanged when fields are absent.

## Technical Design

### Field names
- Frontmatter keys:
  - `plan_id: "plan-1-plan-mode"`
  - `resource_locks: ["edison:plans", "repo:src/edison/core/plan"]`

### Backwards compatibility
- Parsing should tolerate missing keys and type mismatches:
  - treat missing as `None` / `[]`
  - treat non-list values as empty list (fail-open)

## Files to Modify

```
# Modify
src/edison/core/task/models.py
src/edison/core/task/repository.py
src/edison/core/task/index.py
```

## Verification

- [ ] Unit tests for TaskRepository parse/serialize
related:
  - "26.2-wave1-plan-domain-core"
