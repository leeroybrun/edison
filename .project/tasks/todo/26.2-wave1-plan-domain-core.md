---
id: "26.2-wave1-plan-domain-core"
title: "Add Plan domain: model, config, repository, template, schema"
type: feature
owner:
session_id:
parent_id:
child_ids:
depends_on:
  - "26.1-wave1-meta-share-plans"
  - "26.3-wave1-workflow-plan-state-machine"
blocks_tasks:
related:
  - "26.1-wave1-meta-share-plans"
claimed_at:
last_active:
continuation_id:
created_at: "2025-12-28T00:00:00Z"
updated_at: "2025-12-28T00:00:00Z"
tags:
  - plan-mode
  - core
priority: high
estimated_hours:
model:
---

# Add Plan domain: model, config, repository, template, schema

## Summary

Create a first-class **Plan** domain in Edison core, mirroring the patterns used for Tasks and QA:
- file-backed markdown documents with YAML frontmatter
- state-by-directory storage under `.project/plans/<state>/`
- a repository that supports CRUD + unified state transitions
- composed document template `PLAN.md`
- config-driven paths and defaults

Plans are **global** only (no session-scoped storage).

## Required Reading

- `.project/plans/plan-1-plan-mode.md`
- `src/edison/core/task/repository.py` (pattern for markdown + frontmatter persistence)
- `src/edison/core/entity/repository.py` (transition system integration)
- `src/edison/core/utils/paths/management.py` (project management paths helper)

## Objectives

- [ ] Add `plans.yaml` config (paths + defaults; config-first).
- [ ] Add Plan model + PlanRepository.
- [ ] Add `PLAN.md` composed template under documents.
- [ ] Add plan JSON schema (YAML) to schemas domain for future validation.

## Acceptance Criteria

- [ ] `PlanRepository.create/get/save/list_by_state` works on real filesystem layouts.
- [ ] Plan state is derived from directory name (draft/approved/archived).
- [ ] Plan template is composed into `.edison/_generated/documents/PLAN.md`.
- [ ] CLI `edison plan new` (task 26.4) can rely on these primitives.

## Technical Design

### Storage layout
- Root: `.project/plans` (config-driven).
- States: `draft`, `approved`, `archived`.

### Plan model fields (v1)
- `id`, `state`, `title`
- `owners: list[str]`
- `metadata: EntityMetadata` + `state_history`
- `task_id_prefix: Optional[str]`
- `generated_task_ids: list[str]`
- `generation_history: list[dict]` (append-only; timestamps + summary)

### PlanConfig (new domain config)
- `plans.paths.root` (default `.project/plans`)
- `plans.paths.template` (default `.edison/_generated/documents/PLAN.md`)
- `plans.defaults.*` (prefix strings or future UX knobs)

### PlanRepository
- Should follow TaskRepository / QARepository structure:
  - `entity_type = "plan"`
  - `file_extension = ".md"`
  - `_get_state_dir(state)` returns `<plans_root>/<state>`
  - `_get_states_to_search()` is config-driven from WorkflowConfig.get_states("plan")
  - `_plan_to_markdown()` writes frontmatter + preserves body on save
  - `_render_plan_body()` uses composed template, stripping frontmatter like task/qa repos

### Schema + template
- Add `src/edison/data/templates/documents/PLAN.md` (mirrors the style of TASK.md/QA.md).
- Add `src/edison/data/schemas/domain/plan.schema.yaml` (v1).

## Files to Create/Modify

```
# Add
src/edison/data/config/plans.yaml
src/edison/data/templates/documents/PLAN.md
src/edison/data/schemas/domain/plan.schema.yaml
src/edison/core/config/domains/plan.py
src/edison/core/plan/models.py
src/edison/core/plan/repository.py
src/edison/core/plan/__init__.py

# Modify
src/edison/data/config/composition.yaml   # only if needed (documents already uses templates/documents/*.md)
src/edison/core/utils/paths/management.py # add get_plans_root()
```

## Verification

- [ ] Unit tests for PlanRepository (tmp repo root)
- [ ] `edison compose documents` produces `.edison/_generated/documents/PLAN.md`
