---
id: "26.8-wave3-plan-generate-tasks"
title: "Generate tasks/QAs from an approved plan (plan generate-tasks)"
type: feature
owner:
session_id:
parent_id:
child_ids:
depends_on:
  - "26.7-wave3-plan-spec-validate-and-similarity"
  - "26.5-wave2-task-plan-id-and-resource-locks"
blocks_tasks:
related:
  - "26.1-wave1-meta-share-plans"
claimed_at:
last_active:
continuation_id:
created_at: "2025-12-28T00:00:00Z"
updated_at: "2025-12-28T00:00:00Z"
tags:
  - plan-mode
  - generation
priority: high
estimated_hours:
model:
---

# Generate tasks/QAs from an approved plan (plan generate-tasks)

## Summary

Implement `edison plan generate-tasks <plan-id>`:
- Preconditions: plan must be `approved` and valid.
- Deterministically generate Edison tasks and their associated QAs using `TaskQAWorkflow`.
- Link tasks to plan via `plan_id` and group tasks via `related` (O(n) star).
- Persist generated task ids back into plan frontmatter (`generated_task_ids`, `generation_history`).

## Required Reading

- `.project/plans/plan-1-plan-mode.md`
- `src/edison/core/task/workflow.py` (TaskQAWorkflow.create_task)
- `src/edison/core/task/duplication.py` (pre-create checks pattern)
- `src/edison/cli/task/new.py` and `src/edison/cli/task/split.py` (CLI patterns)

## Objectives

- [ ] Add generator implementation in `edison.core.plan.generate`.
- [ ] Add CLI `src/edison/cli/plan/generate_tasks.py`.
- [ ] Add `--dry-run` to show would-be task ids + deps without writing.
- [ ] Add `--force` to bypass duplicate-blocking (if configured).
- [ ] Update plan file frontmatter after generation.
- [ ] Record a Plan Spec fingerprint in `generation_history` to support deterministic drift detection (see Plan Mode doc):
  - store `spec_hash` (sha256 of normalized `yaml edison-plan` content)

## Acceptance Criteria

- [ ] Generating tasks from the same approved plan is deterministic:
  - if tasks already exist, generator must not create duplicates (either skip or error per config).
- [ ] Regeneration fails closed on drift unless explicitly allowed:
  - if current plan spec hash differs from the last `generation_history.spec_hash`, `generate-tasks` must fail unless `--force` (or an explicit drift flag) is provided.
- [ ] Each generated task:
  - has `plan_id` set,
  - has `depends_on` resolved from spec dependency keys,
  - has `resource_locks` set from spec (when present),
  - has `related` set so all plan tasks are in one connected component (O(n)).
- [ ] A QA file exists for each created task (via workflow).
- [ ] Plan frontmatter records `generated_task_ids` and an append-only `generation_history`.

## Output Contract (JSON)

### Dry-run
`edison plan generate-tasks <id> --dry-run --json` returns:
- `planId`
- `state`
- `taskIdPrefix`
- `tasks`: list of `{key, id, title, wave, dependsOn: [ids], resourceLocks: [...] }`
- `duplicates`: (if any) same shape as validate

### Real run
Also includes:
- `createdTaskIds`: list
- `createdQaIds`: list
- `updatedPlanPath`
- `drift`: optional object (when drift detected or checked) describing spec hash comparison and summary

## Technical Design

### Task IDs
Use plan’s `task_id_prefix`:
- If missing, allocate via TaskRepository.get_next_top_level_id() and write it into plan frontmatter first.
- Task id format:
  - Include wave: `{task_id_prefix}-wave{wave}-{slugified-title}`
  - If wave omitted: `{task_id_prefix}-{slugified-title}`

### “Related” star (O(n))
- Choose the first created task id as the anchor.
- For every other task, set `related: [anchor]`.
- (Optional) also set anchor.related to include a few others for discoverability, but keep O(n).

### Duplicate behavior
Reuse existing duplication config semantics:
- If configured “warn”: proceed but print duplicates.
- If configured “block”: fail unless `--force`.

## Files to Create/Modify

```
# Add
src/edison/core/plan/generate.py
src/edison/cli/plan/generate_tasks.py

# Modify
src/edison/core/plan/repository.py   # write-back frontmatter updates (preserve body)
src/edison/core/plan/models.py       # generated_task_ids, task_id_prefix
```

## Verification

- [ ] Unit tests: dry-run vs real run, id stability, write-back correctness
- [ ] Integration test: generate creates tasks and QAs on disk

## Test Cases (minimum)

- [ ] Fails closed if plan not approved
- [ ] Writes `task_id_prefix` into plan once (stable on subsequent runs)
- [ ] If tasks already exist, behavior matches config (skip/warn/block)
related:
  - "26.2-wave1-plan-domain-core"
