---
id: "26.9-wave4-slash-commands-and-start-plan-mode"
title: "Add slash commands + Plan Mode start prompt (brainstorm/refine/approve workflow)"
type: docs
owner:
session_id:
parent_id:
child_ids:
depends_on:
  - "26.8-wave3-plan-generate-tasks"
  - "26.11-wave3-plan-tasks-list-command"
blocks_tasks:
related:
  - "26.1-wave1-meta-share-plans"
claimed_at:
last_active:
continuation_id:
created_at: "2025-12-28T00:00:00Z"
updated_at: "2025-12-28T00:00:00Z"
tags:
  - plan-mode
  - commands
priority: medium
estimated_hours:
model:
---

# Add slash commands + Plan Mode start prompt (brainstorm/refine/approve workflow)

## Summary

Make Plan Mode usable in IDEs by:
- adding plan commands as Edison **command definition markdown files** so Edison generates slash-command help docs,
- adding a start prompt (or guidance doc) that teaches the LLM the Plan Mode workflow:
  - ask questions
  - create plan draft
  - targeted edits
  - validate
  - approve
  - generate tasks (separate)

## Required Reading

- `.project/plans/plan-1-plan-mode.md`
- `src/edison/data/config/commands.yaml` (platform config + domain selection only)
- `src/edison/data/commands/plan/plan-mode.md` (existing umbrella workflow command)
- `src/edison/core/adapters/components/commands.py` (CommandComposer)
- `src/edison/data/start/START_*.md` patterns

## Objectives

- [ ] Ensure `plan` as a command domain is included in command selection config (so it’s included in generated catalogs).
- [ ] Add Edison command definition markdown files under `src/edison/data/commands/plan/` for:
  - `plan-allocate-id` (runs `edison plan allocate-id`)
  - `plan-new` (runs `edison plan new ...`)
  - `plan-list` (runs `edison plan list ...`)
  - `plan-show` (runs `edison plan show <plan-id>`)
  - `plan-validate` (runs `edison plan validate <plan-id> --json`)
  - `plan-approve` (runs `edison plan approve <plan-id>`)
  - `plan-generate-tasks` (runs `edison plan generate-tasks <plan-id> [--dry-run] [--json]`)
  - `plan-tasks` (runs `edison plan tasks <plan-id> [--json]`)
- [ ] Each plan command definition must incorporate the strongest methodology patterns from Spec‑Kit/OpenSpec/BMAD:
  - **Guardrails first**: read-only until approval; no destructive operations; stop on missing prerequisites.
  - **Structured output contract**: stable headings + tables + severity rubric where applicable.
  - **Approval gate**: if edits are recommended, propose a patch plan and wait for explicit approval.
  - **Deterministic grounding**: require `--json` outputs from Edison CLIs when available.
- [ ] Add a start prompt `START_PLAN_MODE.md` that is composable and teaches the workflow end-to-end:
  - clarify (bounded questions)
  - draft plan + Plan Spec block
  - targeted refinement (no rewrites)
  - validate
  - approve
  - generate tasks/QAs
  - analyze drift / correctness (read-only) and propose changes if needed

## Command Definition Contract (REQUIRED)

Each plan command definition file under `src/edison/data/commands/plan/` MUST be self-contained and follow Edison’s command definition schema:

### Frontmatter (required keys)

Each command definition MUST provide:
- `id`: unique stable ID (kebab-case, usually matches file stem)
- `domain`: `plan`
- `command`: the short command name (kebab-case)
- `short_desc`: <120 chars
- `cli`: a command snippet block (prefer JSON mode where available)
- `args`: list of args the LLM should request/validate
- `when_to_use`: bullets
- `related_commands`: list of command IDs

Example:

```yaml
---
id: plan-validate
domain: plan
command: validate
short_desc: "Validate a plan spec (schema, deps, duplicates, parallelism hints)"
cli: |
  edison plan validate <PLAN_ID> --json
args:
  - name: PLAN_ID
    description: Plan id, e.g. plan-1-plan-mode
    required: true
when_to_use: |
  - You changed a plan and need deterministic validation.
related_commands:
  - plan-mode
  - plan-refine
  - plan-sync-tasks
---
```

### Body (required sections)

Each command body MUST include these sections (as headings; content can vary):

1) **Guardrails (NON‑NEGOTIABLE)**
   - Default to read-only guidance.
   - If the command would result in edits, it must end with an explicit Ask/approval gate.
2) **Prerequisites / Inputs**
   - List exact CLI commands to run (including required `--json` flags).
   - Halt if prerequisites are missing or command fails.
3) **Procedure**
   - Step-by-step actions to take with the gathered evidence.
4) **Output Format (STRICT)**
   - Define a stable Markdown output contract (tables + stable IDs + severity rubric if applicable).
5) **Ask / Approval Gate**
   - If any edit is proposed (plan edits, task edits), it MUST ask for explicit approval first.

## Acceptance Criteria

- [ ] `edison compose commands` produces `.cursor/commands/edison.plan-*.md` (and Claude equivalents if enabled).
- [ ] Start prompt exists under `.edison/_generated/start/` after compose.
- [ ] Prompt explicitly instructs targeted edits rather than rewriting entire plan.
- [ ] Plan command prompts are consistent and “workflow rich” (Spec‑Kit/OpenSpec/BMAD style): guardrails → steps → strict output format → ask gate.
- [ ] Command definition files are implementable by an LLM with no Edison history: the file itself contains the required CLI calls, halt conditions, and output contract.

## Files to Create/Modify

```
# Add
src/edison/data/start/START_PLAN_MODE.md
src/edison/data/commands/plan/plan-allocate-id.md
src/edison/data/commands/plan/plan-new.md
src/edison/data/commands/plan/plan-list.md
src/edison/data/commands/plan/plan-show.md
src/edison/data/commands/plan/plan-validate.md
src/edison/data/commands/plan/plan-approve.md
src/edison/data/commands/plan/plan-generate-tasks.md
src/edison/data/commands/plan/plan-tasks.md
```
related:
  - "26.2-wave1-plan-domain-core"
