# Edison Capability Matrix

This document provides a comparison of Edison features across different AI clients and integration methods.

---

## Table of Contents

1. [Overview](#overview)
2. [Client Comparison](#client-comparison)
3. [Feature Details](#feature-details)
4. [Integration Methods](#integration-methods)
5. [Recommendations](#recommendations)

---

## Overview

Edison supports multiple AI clients through different integration methods:

| Client | Integration | FC/RL | CWAM | Rules | Non-Interactive |
|--------|-------------|-------|------|-------|-----------------|
| OpenCode | Plugin | Full | Full | Full | Full |
| Claude Code | Hooks/MCP | Partial | Partial | Full | Partial |
| Codex CLI | CLI/MCP | Prompt | Prompt | Full | Partial |
| Gemini CLI | CLI/MCP | Prompt | Prompt | Full | Partial |
| Pal MCP | MCP | Prompt | Prompt | Full | N/A |

**Legend:**
- **Full**: Native implementation with all features
- **Partial**: Some features available via hooks/workarounds
- **Prompt**: Feature available via prompt injection
- **N/A**: Not applicable for this client

---

## Client Comparison

### OpenCode

**Integration**: TypeScript plugin generated by `edison opencode setup`

| Feature | Support | Notes |
|---------|---------|-------|
| FC (soft continuation) | Full | Single injection on idle |
| RL (hard continuation) | Full | Repeated injection with budgets |
| Output truncation | Full | Configurable limit, header preservation |
| Preemptive compaction | Full | Threshold-based, automatic |
| Recovery compaction | Full | Error-triggered, automatic |
| Compaction hooks | Full | Before/after guidance injection |
| Non-interactive env | Full | Env injection, banned command warnings |
| Session ID resolution | Full | Env, context, fallback |
| Rules injection | Full | State-aware rule injection |
| Token tracking | Full | Heuristic-based estimation |

**Setup:**
```bash
edison opencode setup --all --yes
```

### Claude Code

**Integration**: Hooks + MCP Server

| Feature | Support | Notes |
|---------|---------|-------|
| FC (soft continuation) | Partial | Via pre/post hooks |
| RL (hard continuation) | Partial | Via hooks with manual iteration |
| Output truncation | Partial | Via post-tool hooks |
| Preemptive compaction | No | No native support |
| Recovery compaction | No | No native support |
| Compaction hooks | No | No compaction API |
| Non-interactive env | Partial | Via tool hooks |
| Session ID resolution | Full | Env + MCP |
| Rules injection | Full | Via MCP + prompt injection |
| Token tracking | No | No API for token counts |

**Setup:**
```bash
# Add to .mcp.json
{
  "mcpServers": {
    "edison-pal": {
      "command": "uvx",
      "args": ["--from", "git+https://github.com/BeehiveInnovations/pal-mcp-server.git", "pal-mcp-server"]
    }
  }
}
```

### Codex CLI

**Integration**: CLI invocation + Pal MCP delegation

| Feature | Support | Notes |
|---------|---------|-------|
| FC (soft continuation) | Prompt | Via prompt injection |
| RL (hard continuation) | Prompt | Via wrapper scripts |
| Output truncation | Prompt | Manual in prompts |
| Preemptive compaction | No | No API |
| Recovery compaction | No | No API |
| Compaction hooks | No | No API |
| Non-interactive env | Partial | Via env vars in invocation |
| Session ID resolution | Full | Env + context |
| Rules injection | Full | Via Pal MCP |
| Token tracking | No | No API |

**Setup:**
```bash
# Pal MCP handles delegation
pal-mcp-server --cli codex
```

### Gemini CLI

**Integration**: CLI invocation + Pal MCP delegation

| Feature | Support | Notes |
|---------|---------|-------|
| FC (soft continuation) | Prompt | Via prompt injection |
| RL (hard continuation) | Prompt | Via wrapper scripts |
| Output truncation | Prompt | Manual in prompts |
| Preemptive compaction | No | No API |
| Recovery compaction | No | No API |
| Compaction hooks | No | No API |
| Non-interactive env | Partial | Via env vars in invocation |
| Session ID resolution | Full | Env + context |
| Rules injection | Full | Via Pal MCP |
| Token tracking | No | No API |

### Pal MCP Server

**Integration**: MCP protocol for multi-client orchestration

| Feature | Support | Notes |
|---------|---------|-------|
| FC (soft continuation) | Prompt | Injected into composed prompts |
| RL (hard continuation) | Prompt | Injected into composed prompts |
| Output truncation | Prompt | Via Edison config |
| Preemptive compaction | N/A | Delegated to clients |
| Recovery compaction | N/A | Delegated to clients |
| Compaction hooks | N/A | Delegated to clients |
| Non-interactive env | N/A | Delegated to clients |
| Session ID resolution | Full | Via clink continuation_id |
| Rules injection | Full | Via Edison rules engine |
| Token tracking | N/A | Delegated to clients |

---

## Feature Details

### Continuation (FC/RL)

| Client | Mechanism | Budgets | Cooldowns | Stop on Blocked |
|--------|-----------|---------|-----------|-----------------|
| OpenCode | Plugin event | Yes | Yes | Yes |
| Claude Code | Hooks | Manual | Manual | Manual |
| Codex CLI | Prompt | No | No | No |
| Gemini CLI | Prompt | No | No | No |
| Pal MCP | Prompt | No | No | No |

**Full support** means the client natively tracks:
- Iteration counts
- Cooldown timers
- Blocked session detection

**Prompt support** means Edison injects continuation guidance into the prompt, but the client doesn't enforce it.

### Context Window Management (CWAM)

| Client | Truncation | Preemptive | Recovery | Hooks |
|--------|------------|------------|----------|-------|
| OpenCode | Full | Full | Full | Full |
| Claude Code | Partial | No | No | No |
| Codex CLI | Prompt | No | No | No |
| Gemini CLI | Prompt | No | No | No |
| Pal MCP | Prompt | N/A | N/A | N/A |

**Full support** means:
- Native implementation in plugin/hooks
- Configurable thresholds
- Automatic triggering

### Rules Injection

| Client | State-Aware | Transition Rules | Guidance Rules |
|--------|-------------|------------------|----------------|
| OpenCode | Yes | Yes | Yes |
| Claude Code | Yes | Yes | Yes |
| Codex CLI | Yes | Yes | Yes |
| Gemini CLI | Yes | Yes | Yes |
| Pal MCP | Yes | Yes | Yes |

All clients support rules injection via:
```bash
edison rules inject --state <state> --json
```

### Non-Interactive Environment

| Client | Env Injection | Banned Commands | Warning/Block |
|--------|---------------|-----------------|---------------|
| OpenCode | Full | Full | Configurable |
| Claude Code | Partial | Partial | Via hooks |
| Codex CLI | Partial | No | No |
| Gemini CLI | Partial | No | No |
| Pal MCP | N/A | N/A | N/A |

---

## Integration Methods

### Plugin Integration (OpenCode)

Best for: Full-featured Edison experience

```bash
# Generate plugin
edison opencode setup --all --yes

# OpenCode auto-discovers
opencode
```

**Pros:**
- Native implementation of all features
- No external dependencies
- Fast and reliable

**Cons:**
- OpenCode-specific
- Requires TypeScript runtime

### Hook Integration (Claude Code)

Best for: Claude Code with partial Edison features

```python
# Pre-tool hook
def before_tool(tool, args):
    if tool == "bash":
        args["env"].update(edison_non_interactive_env())
    return args

# Post-tool hook
def after_tool(tool, result):
    result["output"] = truncate(result["output"])
    return result

# Idle hook
def on_idle():
    payload = edison_session_next()
    if payload["continuation"]["shouldContinue"]:
        inject_prompt(payload["continuation"]["prompt"])
```

**Pros:**
- Works with Claude Code
- Partial CWAM support

**Cons:**
- No native compaction
- Manual iteration tracking

### MCP Integration (All Clients)

Best for: Multi-client orchestration via Pal

```json
{
  "mcpServers": {
    "edison-pal": {
      "command": "uvx",
      "args": ["--from", "git+https://github.com/BeehiveInnovations/pal-mcp-server.git", "pal-mcp-server"],
      "env": {
        "PAL_WORKING_DIR": "/path/to/project"
      }
    }
  }
}
```

**Pros:**
- Works with any MCP client
- Full rules injection
- Delegation support

**Cons:**
- Features limited to prompt injection
- No native CWAM

### CLI Integration (Direct)

Best for: Simple automation and scripts

```bash
# Get next actions
edison session next <session-id> --json

# Check completion
edison session next <session-id> --completion-only --json

# Get rules for state
edison rules inject --state <state> --json
```

**Pros:**
- Works everywhere
- Simple to script

**Cons:**
- Manual orchestration
- No automatic continuation

---

## Recommendations

### Best Overall Experience

**Use OpenCode** with the Edison plugin for the most complete feature set:

```bash
edison opencode setup --all --yes
export AGENTS_SESSION=my-session
opencode
```

### Multi-Model Orchestration

**Use Pal MCP** for delegating to multiple models:

```bash
# Configure Pal with Edison
pal-mcp-server --config ~/.pal/config.yaml

# Pal handles:
# - Continuation prompt injection
# - Rules injection per state
# - Model selection per task type
```

### Claude Code Users

**Use hooks + MCP** for partial Edison integration:

```python
# Install hooks for:
# - Non-interactive env
# - Output truncation (manual)
# - Continuation (manual iteration)

# Use MCP for:
# - Rules injection
# - Session context
# - Task/QA operations
```

### Automation/CI

**Use CLI directly** for scripted workflows:

```bash
#!/bin/bash
SESSION=ci-session-$(date +%s)

# Create session
edison session create --id $SESSION

# Claim and work
edison task claim $TASK_ID --session $SESSION

# Check for completion
while true; do
  COMPLETE=$(edison session next $SESSION --completion-only --json | jq -r '.completion.isComplete')
  if [ "$COMPLETE" = "true" ]; then
    break
  fi
  # Work on next action
  ACTION=$(edison session next $SESSION --json | jq -r '.actions[0].cmd | join(" ")')
  eval $ACTION
done

# Close session
edison session close $SESSION
```

---

## See Also

- [CONTINUATION.md](CONTINUATION.md) - FC/RL continuation system
- [CONTEXT_WINDOW_MANAGEMENT.md](CONTEXT_WINDOW_MANAGEMENT.md) - CWAM documentation
- [OPENCODE_INTEGRATION.md](OPENCODE_INTEGRATION.md) - OpenCode plugin setup
- [PAL_SETUP.md](PAL_SETUP.md) - Pal MCP Server setup
- [CONFIGURATION.md](CONFIGURATION.md) - Full configuration guide

---

**Last Updated:** 2026-01-04
**Version:** 2.0.0
