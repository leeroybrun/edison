$schema: https://json-schema.org/draft/2020-12/schema
$id: https://schemas.edison/core/config.schema.yaml
title: Edison Config Schema (Generic)
description: Configuration schema for defaults.yaml and edison.yaml.
type: object
properties:
  pal:
    type: object
    properties:
      retry:
        type: object
        properties:
          max_attempts:
            type: integer
            minimum: 1
            maximum: 10
          initial_delay_seconds:
            type: number
            minimum: 0.1
          backoff_factor:
            type: number
            minimum: 1.0
        additionalProperties: false
      secret_rotation:
        type: object
        required:
        - enabled
        - check_interval_hours
        properties:
          enabled:
            type: boolean
          check_interval_hours:
            type: integer
            minimum: 1
            maximum: 168
          notification_threshold_days:
            type: integer
            minimum: 1
            maximum: 90
        additionalProperties: false
      prompt_base_model:
        type: string
        description: Base model key used to compose the shared Pal builtin prompts (default/planner/codereviewer).
      cli_clients:
        type: object
        description: Configuration for Pal MCP clink cli_clients JSON generation.
        properties:
          enabled:
            type: boolean
          clients:
            type: object
            description: CLI client definitions (one JSON per client).
            additionalProperties:
              type: object
              properties:
                command:
                  type: string
                additional_args:
                  type: array
                  items:
                    type: string
                env:
                  type: object
                  additionalProperties:
                    type: string
              additionalProperties: true
          roles:
            type: object
            description: Role generation settings for cli_clients JSON.
            properties:
              builtin:
                type: array
                items:
                  type: string
              include_generated_agents:
                type: boolean
              include_generated_validators:
                type: boolean
              prefixes:
                type: object
                properties:
                  agent:
                    type: string
                  validator:
                    type: string
                additionalProperties: false
            additionalProperties: false
        additionalProperties: false
    additionalProperties: false
  paths:
    type: object
    properties:
      project_config_dir:
        type: string
        description: Preferred project configuration directory name (e.g., .edison).
        default: .edison
      user_config_dir:
        type: string
        description: Preferred user configuration directory name under the home directory (e.g., .edison).
        default: .edison
      config_dir:
        type: string
        description: Legacy alias for paths.project_config_dir.
      management_dir:
        type: string
        description: Legacy alias for project_management_dir (project management root, e.g. .project).
    additionalProperties: false
  project_management_dir:
    type: string
    description: Project management root directory (e.g., .project).
    default: .project
  orchestration:
    type: object
    description: Multi-agent orchestration and process tracking configuration.
    properties:
      allowCliEngines:
        description: Whether Edison may execute external CLI validator engines.
        oneOf:
        - type: boolean
        - type: string
        - type: array
          items:
            type: string
      tracking:
        type: object
        properties:
          activeStaleSeconds:
            type: integer
            minimum: 0
            description: Staleness threshold (seconds since lastActive) for marking runs stale.
          processEventsJsonl:
            type: string
            description: Append-only JSONL process events log path (relative to repo root).
        additionalProperties: false
      maxConcurrentAgents:
        type: integer
        minimum: 1
        description: Maximum concurrent agents/validators to run.
      validatorTimeout:
        type: integer
        minimum: 1
        description: Default validator timeout (seconds).
      executionMode:
        type: string
        description: Orchestration execution mode.
    additionalProperties: false
  memory:
    type: object
    description: Optional provider-driven long-term memory configuration.
    properties:
      enabled:
        type: boolean
        default: false
      defaults:
        type: object
        properties:
          maxHits:
            type: integer
            minimum: 0
            default: 5
        additionalProperties: false
      paths:
        type: object
        properties:
          root:
            type: string
          codebaseMapFile:
            type: string
          patternsFile:
            type: string
          gotchasFile:
            type: string
          sessionInsightsDir:
            type: string
        additionalProperties: false
      contextInjection:
        type: object
        properties:
          enabled:
            type: boolean
            default: false
          limit:
            type: integer
            minimum: 0
            default: 0
          queryTemplate:
            type: string
          heading:
            type: string
          maxCharsPerHit:
            type: integer
            minimum: 0
            default: 800
        additionalProperties: false
      providers:
        type: object
        additionalProperties:
          $ref: '#/$defs/memory_provider'
      pipelines:
        type: object
        additionalProperties:
          $ref: '#/$defs/memory_pipeline'
    additionalProperties: false
  tasks:
    type: object
    description: Task + QA project-state configuration.
    properties:
      paths:
        type: object
        additionalProperties: true
      defaults:
        type: object
        additionalProperties: true
      readiness:
        type: object
        additionalProperties: true
      similarity:
        type: object
        properties:
          topK: { type: integer, minimum: 0 }
          threshold: { type: number, minimum: 0 }
          useShingles: { type: boolean }
          shingleSize: { type: integer, minimum: 1 }
          titleWeight: { type: number, minimum: 0 }
          bodyWeight: { type: number, minimum: 0 }
          semantic:
            type: object
            properties:
              enabled: { type: boolean, default: false }
              providers:
                type: array
                items: { type: string }
                default: []
              maxHits: { type: integer, minimum: 0, default: 5 }
              queryTemplate: { type: string, default: "{query}" }
            additionalProperties: false
          preCreate:
            type: object
            properties:
              enabled: { type: boolean, default: false }
              action:
                type: string
                enum: [warn, block, none]
                default: warn
              threshold:
                type:
                - number
                - 'null'
                default: null
              topK:
                type:
                - integer
                - 'null'
                minimum: 0
                default: null
              states:
                type:
                - array
                - 'null'
                items: { type: string }
                default: null
            additionalProperties: false
        additionalProperties: false
    additionalProperties: true
  project:
    type: object
    required:
    - name
    properties:
      name:
        type: string
        description: Project name used in placeholders
        examples:
        - '{PROJECT_NAME}'
        - my-project
      owner:
        description: Default owner for tasks/sessions; overrides process detection
          when set
        type:
        - string
        - 'null'
        default: null
      description:
        type: string
        description: Human-readable project description.
      language:
        type: string
        description: Primary project language (project-level metadata).
      pythonVersion:
        type: string
        description: Python version string (project-level metadata).
      sourceDir:
        type: string
        description: Primary source directory (project-level metadata).
      testsDir:
        type: string
        description: Primary tests directory (project-level metadata).
      commands:
        type: object
        description: Project command shortcuts (project-level metadata).
        additionalProperties:
          type: string
      paths:
        type: object
        description: Project path shortcuts (project-level metadata).
        additionalProperties:
          type: string
      audit_terms:
        description: Additional project-specific terms to ban from core/pack guidelines
        type: array
        items:
          type: string
        default: []
      type:
        type: string
        description: Optional project category (used for discovery/templating).
      tech_stack:
        type: array
        description: Optional human-readable list of key technologies in this project.
        items:
          type: string
        default: []
    additionalProperties: true
  session:
    type: object
    properties:
      worktree:
        type: object
        properties:
          uuidSuffixLength:
            type: integer
            minimum: 1
            maximum: 32
            description: Length of UUID suffix used when resolving worktree path collisions.
          timeouts:
            type: object
            description: Timeout values for worktree operations (in seconds)
            properties:
              health_check:
                type: integer
                minimum: 1
                default: 10
              fetch:
                type: integer
                minimum: 1
                default: 60
              checkout:
                type: integer
                minimum: 1
                default: 30
              worktree_add:
                type: integer
                minimum: 1
                default: 30
              clone:
                type: integer
                minimum: 1
                default: 60
              install:
                type: integer
                minimum: 1
                default: 300
              branch_check:
                type: integer
                minimum: 1
                default: 10
              prune:
                type: integer
                minimum: 1
                default: 10
            additionalProperties: false
        required:
        - uuidSuffixLength
        additionalProperties: true
      timeoutMinutes:
        type: integer
        minimum: 1
        maximum: 10080
        default: 60
      context:
        type: object
        properties:
          payload:
            type: object
            properties:
              fields:
                type: array
                items:
                  type: string
            additionalProperties: false
          render:
            type: object
        additionalProperties: true
      next:
        type: object
        properties:
          output:
            type: object
            properties:
              headerTemplate:
                type: string
              footerTemplate:
                type: string
              sections:
                type: object
                additionalProperties:
                  type: object
                  properties:
                    enabled:
                      type: boolean
                  additionalProperties: false
            additionalProperties: false
        additionalProperties: true
    additionalProperties: true
  worktrees:
    type: object
    description: Top-level worktree configuration (used for baseDirectory, archiveDirectory,
      branchPrefix, etc.).
    properties:
      enabled:
        type: boolean
        default: true
      baseBranchMode:
        type: string
        description: Base ref selection mode for session worktree creation. "current" uses the current primary worktree HEAD ref, "fixed" uses worktrees.baseBranch.
        enum:
        - current
        - fixed
        default: current
      baseBranch:
        description: Base ref to branch from when baseBranchMode is "fixed". When null, the current primary worktree HEAD ref is used.
        type:
        - string
        - 'null'
        default: null
      baseDirectory:
        type: string
        description: Base directory for session worktrees.
        default: ../{PROJECT_NAME}-worktrees
        examples:
        - ../my-project-worktrees
        - /var/lib/edison-worktrees
      archiveDirectory:
        type: string
        description: Archive directory for session worktrees.
        default: ../{PROJECT_NAME}-worktrees/_archived
      branchPrefix:
        type: string
        default: session/
      pathTemplate:
        type: string
        description: Optional path template for worktree location.
        default: ../{PROJECT_NAME}-worktrees/{sessionId}
      sharedState:
        type: object
        description: Configuration for sharing `.project/*` and generated artifacts across session worktrees.
        properties:
          mode:
            type: string
            enum:
            - meta
            - primary
            - external
            default: meta
          metaBranch:
            type: string
            default: edison-meta
          metaPathTemplate:
            type: string
            default: ../{PROJECT_NAME}-worktrees/_meta
          externalPath:
            description: Used when sharedState.mode is "external".
            type:
            - string
            - 'null'
            default: null
          sharedPaths:
            description: Additional repo-root relative paths to share via symlink into worktrees.
            type: array
            default: []
            items:
              oneOf:
              - type: string
              - type: object
                properties:
                  path:
                    type: string
                  scopes:
                    type: array
                    items:
                      type: string
                    default:
                    - session
                  type:
                    type: string
                    enum:
                    - dir
                    - file
                    default: dir
                  targetRoot:
                    type: string
                    enum:
                    - shared
                    - primary
                    default: shared
                  mergeExisting:
                    type: boolean
                    default: true
                  enabled:
                    type: boolean
                    default: true
                  commitAllowed:
                    type: boolean
                    default: true
                  commitAllowPrefixes:
                    description: Optional extra allowlist prefixes for meta commits (used when a shared dir is not committable as a whole but some subpaths are).
                    type: array
                    items:
                      type: string
                    default: []
                required:
                - path
                additionalProperties: false
          # shareGenerated/generatedSource removed: `.edison/_generated` is managed via sharedPaths
          gitExcludes:
            type: object
            properties:
              primary:
                type: array
                items:
                  type: string
                default: []
              session:
                type: array
                items:
                  type: string
                default: []
              meta:
                type: array
                items:
                  type: string
                default: []
            additionalProperties: false
          commitGuard:
            type: object
            properties:
              enabled:
                type: boolean
                default: true
              allowPrefixes:
                type: array
                items:
                  type: string
                default: []
            additionalProperties: false
        additionalProperties: false
      installDeps:
        type: boolean
        default: false
      postInstallCommands:
        type: array
        description: Optional commands to run after dependency installation in the session worktree (executed via `bash -lc` in the worktree directory).
        items:
          type: string
        default: []
      enableDatabaseIsolation:
        type: boolean
        default: false
      autoCleanupOnMerge:
        type: boolean
        default: false
      cleanup:
        type: object
        properties:
          autoArchive:
            type: boolean
            default: true
          archiveAfterDays:
            type: integer
            minimum: 0
            default: 30
          deleteAfterDays:
            type: integer
            minimum: 0
            default: 90
        additionalProperties: false
      enforcement:
        type: object
        description: Optional hard enforcement for session-scoped commands. When enabled,
          commands listed under worktrees.enforcement.commands are blocked unless the
          process is running inside the session worktree directory.
        properties:
          enabled:
            type: boolean
            default: true
          commands:
            type: array
            items:
              type: string
            default: []
        additionalProperties: false
    additionalProperties: false
  orchestrators:
    type: object
    description: Configuration for orchestrator launch profiles.
    properties:
      default:
        type: string
      profiles:
        type: object
    additionalProperties: true
  delegation:
    $ref: '#/$defs/delegation'
  validators:
    type: object
    properties:
      enabled:
        type: array
        items:
          type: string
        description: List of enabled validator names
        examples:
        - - security
          - performance
    additionalProperties: false
  quality:
    type: object
    description: Quality control and test coverage configuration
    properties:
      coverage:
        type: object
        properties:
          overall:
            type: integer
            minimum: 0
            maximum: 100
            description: Minimum overall code coverage percentage
          changed:
            type: integer
            minimum: 0
            maximum: 100
            description: Minimum coverage for changed lines
        additionalProperties: false
      allowSkip:
        type: boolean
        description: Allow skipping tests
        default: false
      blockOnFailingTests:
        type: boolean
        description: Block operations when tests fail
        default: true
    additionalProperties: false
  packs:
    description: Pack configuration. Supports legacy array or v2 object form.
    oneOf:
    - type: object
      description: Pack engine (v2) configuration
      properties:
        enabled:
          type: boolean
          default: true
        directory:
          type: string
          default: .edison/packs
        compositionMode:
          type: string
          enum:
          - layered
          default: layered
        discoveryMode:
          type: string
          enum:
          - auto
          - manual
          default: auto
        active:
          type: array
          items:
            type: string
            pattern: ^[a-z][a-z0-9-]*$
          default: []
        portability:
          type: object
          properties:
            userOnly:
              type: string
              enum: [warn, error, off]
              default: warn
            missing:
              type: string
              enum: [warn, error, off]
              default: warn
          additionalProperties: true
      additionalProperties: true
    - type: array
      items:
        type: string
        minLength: 1
    - type: array
      items:
        type: object
        required:
        - name
        properties:
          name:
            type: string
          version:
            type: string
          source:
            type: string
        additionalProperties: false
$defs:
  delegation:
    type: object
    properties:
      roles:
        type: array
        items:
          type: object
          required:
          - name
          properties:
            name:
              type: string
            capabilities:
              type: array
              items:
                type: string
            constraints:
              type: object
          additionalProperties: false
      mcp:
        type: object
        properties:
          endpoint:
            type: string
          tokenRef:
            type: string
        additionalProperties: false
    additionalProperties: true
  memory_provider:
    description: Provider configuration entry under memory.providers.<id>.
    oneOf:
    - type: object
      required: [kind, command, searchArgs]
      properties:
        kind: { const: external-cli }
        enabled: { type: boolean, default: true }
        command: { type: string }
        searchArgs:
          type: array
          items: { type: string }
        saveArgs:
          type: array
          items: { type: string }
          default: []
        indexArgs:
          type: array
          items: { type: string }
          default: []
        timeoutSeconds:
          type: integer
          minimum: 1
          default: 10
      additionalProperties: false
    - type: object
      required: [kind, command, searchArgs]
      properties:
        kind: { const: external-cli-text }
        enabled: { type: boolean, default: true }
        command: { type: string }
        searchArgs:
          type: array
          items: { type: string }
        saveArgs:
          type: array
          items: { type: string }
          default: []
        indexArgs:
          type: array
          items: { type: string }
          default: []
        timeoutSeconds:
          type: integer
          minimum: 1
          default: 10
      additionalProperties: false
    - type: object
      required: [kind, specDir]
      properties:
        kind: { const: graphiti-python }
        enabled: { type: boolean, default: true }
        module: { type: string, default: graphiti_memory }
        class: { type: string, default: GraphitiMemory }
        specDir: { type: string }
        groupIdMode: { type: string, default: project }
        includeProjectContext: { type: boolean, default: true }
        includeSessionHistory: { type: boolean, default: false }
        sessionHistoryLimit: { type: integer, minimum: 0, default: 3 }
        saveMethod: { type: string, default: save_pattern }
        saveStructuredMethod: { type: string, default: save_structured_insights }
        saveTemplate: { type: string, default: "{summary}" }
      additionalProperties: false
    - type: object
      required: [kind, serverId, searchTool]
      properties:
        kind: { const: mcp-tools }
        enabled: { type: boolean, default: true }
        serverId: { type: string }
        searchTool: { type: string }
        readTool:
          type:
          - string
          - 'null'
          default: null
        responseFormat: { type: string, default: json }
        timeoutSeconds: { type: integer, minimum: 1, default: 10 }
        searchArguments:
          type:
          - object
          - 'null'
          default: null
      additionalProperties: false
    - type: object
      required: [kind]
      properties:
        kind: { const: file-store }
        enabled: { type: boolean, default: true }
      additionalProperties: false
  memory_pipeline:
    description: Pipeline configuration entry under memory.pipelines.<event>.
    type: object
    properties:
      enabled:
        type: boolean
        default: false
      steps:
        type: array
        items:
          $ref: '#/$defs/memory_pipeline_step'
        default: []
    additionalProperties: false
  memory_pipeline_step:
    type: object
    required: [kind]
    properties:
      id:
        type: string
      kind:
        type: string
        enum:
        - session-insights-v1
        - provider-save-structured
        - provider-save-text
        - provider-index
      provider:
        type: string
      inputVar:
        type: string
      outputVar:
        type: string
    additionalProperties: false
additionalProperties: true
