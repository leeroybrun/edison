$schema: https://json-schema.org/draft/2020-12/schema
$id: https://schemas.edison/core/delegation.schema.yaml
title: Edison Delegation Schema (Generic)
description: Delegation routing rules and resilience settings (project-agnostic).
type: object
required:
- delegation
properties:
  delegation:
    type: object
    required:
    - implementers
    - resilience
    - filePatternRules
    - taskTypeRules
    properties:
      implementers:
        type: object
        required:
        - primary
        - fallbackChain
        - maxFallbackAttempts
        properties:
          primary:
            type: string
            minLength: 1
          fallbackChain:
            type: array
            items:
              type: string
              minLength: 1
          maxFallbackAttempts:
            type: integer
            minimum: 0
        additionalProperties: false
      resilience:
        type: object
        required:
        - circuitBreaker
        - retryLogic
        properties:
          circuitBreaker:
            type: object
            required:
            - enabled
            - failureThreshold
            - resetTimeoutSeconds
            properties:
              enabled:
                type: boolean
              failureThreshold:
                type: integer
                minimum: 1
              resetTimeoutSeconds:
                type: integer
                minimum: 1
            additionalProperties: false
          retryLogic:
            type: object
            required:
            - enabled
            - maxRetries
            - backoffMultiplier
            - maxBackoffSeconds
            properties:
              enabled:
                type: boolean
              maxRetries:
                type: integer
                minimum: 0
              backoffMultiplier:
                type: number
                minimum: 0
              maxBackoffSeconds:
                type: integer
                minimum: 0
            additionalProperties: false
        additionalProperties: false
      filePatternRules:
        type: object
        description: Map of glob pattern â†’ delegation rule
        propertyNames:
          type: string
          minLength: 1
        patternProperties:
          .*:
            type: object
            required:
            - preferredModel
            - subAgentType
            properties:
              preferredModel:
                type: string
              preferredModels:
                type: array
                items:
                  type: string
              reason:
                type: string
              subAgentType:
                type: string
              delegation:
                type: string
                enum:
                - required
                - partial
              delegateVia:
                type: string
              preferredZenRole:
                type: string
              confidence:
                type: string
              examples:
                type: array
                items:
                  type: string
              excludePatterns:
                type: array
                items:
                  type: string
              note:
                type: string
            additionalProperties: false
        additionalProperties: false
      taskTypeRules:
        type: object
        properties:
          delegationValues:
            type: object
            properties:
              required:
                type: string
              partial:
                type: string
            additionalProperties: false
        patternProperties:
          ^(?!delegationValues$).*:
            type: object
            required:
            - subAgentType
            - delegation
            properties:
              preferredModel:
                type: string
              preferredModels:
                type: array
                items:
                  type: string
              subAgentType:
                type: string
              delegation:
                type: string
                enum:
                - required
                - partial
              preferredZenRole:
                type: string
              reason:
                type: string
              description:
                type: string
              examples:
                type: array
                items:
                  type: string
            additionalProperties: false
        additionalProperties: false
    additionalProperties: false
additionalProperties: false
