# TDD (Test-Driven Development)

> **Extended Version:** For detailed TDD patterns, evidence requirements, and comprehensive examples, see [Extended TDD Guide](../../guides/extended/TDD.md)

## TDD Checklist
- [ ] RED: I wrote a failing test first (and it failed for the right reason)
- [ ] GREEN: I wrote the minimum code to pass the test (no extras)
- [ ] REFACTOR: I improved code while keeping tests green
- [ ] Evidence: test failure and success outputs documented

## RED-GREEN-REFACTOR Cycle
- RED: write a failing test first and confirm it fails for the right reason.
- GREEN: add the minimum code required to make the test pass—no extras.
- REFACTOR: improve the code with all tests green, then rerun the full suite.
- Repeat the cycle for every feature/change.

## Core Rules
- Fail first; do not skip the RED step.
- Minimal green code; avoid speculative features.
- Refactor with a full test run before proceeding.
- Coverage ≥90% overall; 100% on new or changed files.
- Update tests only to reflect agreed spec/format changes, never just to "make green." 
- Keep output clean—no console noise.

## Guardrails
- No `.skip` / `.todo` (or equivalents) committed.
- Do not leave debugging logs in tests.

## Patterns

### Pattern 1: Committed Data + Unique IDs

**Problem:** Tests fail randomly due to data collisions

**Solution:** Use unique identifiers and commit test data

1. Generate unique IDs for test entities
2. Commit data to database before assertions
3. Clean up in afterEach/afterAll

### Pattern 2: PostgreSQL Template Pool

**Problem:** Slow test setup due to migrations

**Solution:** Use template databases

1. Create template database once
2. Clone for each test
3. Drop clones after tests

## Commit Tag Requirements
Commits MUST include explicit markers to document TDD compliance:
- `[RED]` tag for commits with failing test (test written before implementation)
- `[GREEN]` tag for commits where tests pass (minimal implementation added)
- `[REFACTOR]` tag for commits with code cleanup (tests still green)

Example commit messages:
```
[RED] Add failing test for user authentication flow
[GREEN] Implement JWT validation to pass auth tests
[REFACTOR] Extract token validation into reusable helper
```

## Evidence Requirements
- Test file created/committed BEFORE implementation file (verify via git history).
- Commits MUST include explicit markers: `[RED]` then `[GREEN]` (in order).
- RED failure documented → GREEN pass documented → REFACTOR documented.
- Provide RED then GREEN markers or commits in order.
- Attach test output showing the failing run and the passing run.
- Include a coverage report for the round.
- Use `edison tasks ready --run` to collect trusted evidence files; if TDD must be skipped, call `edison tasks ready --disable-tdd --reason "justification"` and record the rationale in the QA brief.
- Evidence files must be generated by `edison tasks ready --run` (trusted runner markers + timestamps). Manual fabrication is rejected.
- Readiness guard auto-detects post-training packages from the git diff and blocks if matching Context7 markers (`context7-<pkg>.txt`, HMAC-stamped when enabled) are missing.
- Evidence filenames and required commands come from ConfigManager overlays (`.edison/core/config/*.yaml` → `.agents/config/*.yml`); do not invent your own list.
