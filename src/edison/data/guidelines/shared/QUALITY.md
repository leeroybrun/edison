# Quality Standards (Core)

> **Extended Version:** For detailed quality gates, evidence expectations, and examples, see [Extended Quality Guide](../../guides/extended/QUALITY.md)

## Quality Checklist
- **Type Safety:** No untyped escape hatches; justify any suppressions.
- **Error Surfaces:** Async flows expose clear `loading` / `error` / `empty` states.
- **UX & Accessibility:** Responsive across breakpoints; keyboard + screen-reader friendly; no contrast violations.
- **Code Hygiene:** No TODO/FIXME placeholders; no stray logs; remove dead code.
- **Testing:** Prefer real behavior over mocks on critical paths; deterministic, isolated tests with no `.only`/`.skip`/`.todo`.
- **Performance & Parallel Safety:** Avoid shared global state; use unique identifiers for data created in tests or fixtures.

## Artifact Completeness (Blocking)
- Task document is self-contained: assumptions, scope boundaries, interfaces/contracts, explicit acceptance criteria, measurable success criteria.
- QA brief is self-contained: preconditions, explicit commands, expected results (pass/fail), validator roster, evidence links.
- Evidence paths are recorded in the task/QA docs, not just on disk.

## Task Completion Criteria
A task moves to `tasks/validated/` only when:
1) Implementation is complete and documented in the task file.
2) Tests for new/changed code are present and passing.
3) Automation (type-check, lint, test, build or project equivalent) succeeds.
4) All blocking validators approve and QA sits in `qa/validated/` (or project-equivalent state).
5) Task and QA documents are up to date with status, findings, and evidence links.

## Verification Command

Before marking any task as ready, run:

```bash
pnpm run type-check && pnpm run lint && pnpm run test && pnpm run build
```

All must pass with zero warnings.

## Pre-commit Hook

The pre-commit hook runs:

```bash
node packages/qa-tools/bin/check-test-flags.mjs --staged
```

This prevents committing code with:
- `.skip()` or `.only()` in tests
- `.todo()` markers
- `console.log()` debug statements
- `@ts-ignore` or explicit `any` in staged TS files

## No-Mock Policy

NEVER mock critical internal services:
- Database clients - Use real database with test isolation strategies
- Authentication flows - Use real auth implementations
- HTTP route handlers - Test with real HTTP requests

Use real behavior assertions, not mock verifications. Forbidden assertions include spying on internal database client calls as proof of behavior (`toHaveBeenCalled` on database methods).

## Test Database Setup

Use project-configured test database isolation strategies:

```bash
# Check project-specific test setup in pack guidelines
# Typically involves containerized test databases or in-memory alternatives
```

Use project test utilities for database isolation (e.g., `withTestDatabase()`, `withSeededDatabase()`). Do not hand-roll DB management or transactions for isolation. Refer to active database pack guidelines for specific setup instructions.

## Banned Test Patterns

These patterns are FORBIDDEN in committed code:
- `.skip()` - No skipped tests
- `.only()` - No focused tests
- `.todo()` - No placeholder tests
- `console.log()` - No debug output

The pre-commit hook will block these. Evidence must be generated by trusted runners, not manually fabricated.
