validation:
  dimensions:
    functionality: 30
    reliability: 25
    security: 20
    maintainability: 15
    performance: 10

  cache:
    directory: "{PROJECT_CONFIG_DIR}/_generated/validators"

  execution:
    mode: parallel        # parallel | sequential
    concurrency: 4        # max parallel validators when mode=parallel
    timeout: 300          # per-validator timeout in seconds

  # Defaults for validator assignment
  defaults:
    wave: comprehensive   # Default wave for validators without explicit wave assignment

  # Engine definitions (execution backends)
  # Each engine defines how to execute validators using that backend
  engines:
    codex-cli:
      type: cli
      command: "codex"
      # Note: shell_environment_policy.inherit=all provides full env for dev tools (uv, mypy, ruff).
      # We explicitly exclude session-related vars to prevent test interference.
      pre_flags: ["--ask-for-approval", "never", "--sandbox", "workspace-write", "-c", "shell_environment_policy.inherit=all", "-c", "shell_environment_policy.exclude=[\"AGENTS_SESSION\", \"EDISON_SESSION_ID\"]"]
      subcommand: "exec"
      output_flags: ["--json"]
      read_only_flags: []
      response_parser: codex
      prompt_mode: stdin
      stdin_prompt_arg: "-"

    claude-cli:
      type: cli
      command: "claude"
      subcommand: "-p"
      output_flags: ["--output-format", "json"]
      # Plan mode blocks Read/Bash tools, which prevents validators from reading diffs/evidence.
      # Keep Claude non-interactive while disallowing edits.
      read_only_flags: ["--permission-mode", "dontAsk", "--disallowed-tools", "Edit"]
      response_parser: claude
      prompt_mode: arg

    gemini-cli:
      type: cli
      command: "gemini"
      output_flags: ["--output-format", "json"]
      read_only_flags: []
      response_parser: gemini
      prompt_mode: arg

    auggie-cli:
      type: cli
      command: "auggie"
      subcommand: ""
      output_flags: ["--output-format", "json"]
      read_only_flags: ["--print", "--quiet"]
      response_parser: auggie
      prompt_mode: file
      prompt_flag: "--instruction-file"

    coderabbit-cli:
      type: cli
      command: "coderabbit"
      subcommand: "review"
      output_flags: []
      read_only_flags: ["--prompt-only"]
      response_parser: coderabbit
      prompt_mode: file
      prompt_flag: "--config"

    pal-mcp:
      type: delegated
      description: "Generate delegation instructions for orchestrator"

  # Flat validator definitions
  # Each validator references an engine and optionally a fallback.
  #
  # Core is technology-agnostic: only cross-cutting validators live here.
  # Packs/projects may add additional validators via config overlays.
  validators:
    # Global validators - always run, use same prompt with different models
    global-codex:
      name: "Global Validator (Codex)"
      engine: codex-cli
      fallback_engine: pal-mcp
      prompt: "_generated/validators/global.md"
      wave: critical
      always_run: true
      blocking: true
      timeout: 600
      context7_required: true
      context7_packages: []
      triggers: ["*"]
      focus: []

    global-claude:
      name: "Global Validator (Claude)"
      engine: claude-cli
      fallback_engine: pal-mcp
      prompt: "_generated/validators/global.md"
      wave: critical
      always_run: true
      blocking: true
      timeout: 300
      context7_required: true
      context7_packages: []
      triggers: ["*"]
      focus: []

    global-gemini:
      name: "Global Validator (Gemini)"
      engine: gemini-cli
      fallback_engine: pal-mcp
      prompt: "_generated/validators/global.md"
      wave: critical
      always_run: false
      blocking: false  # Non-blocking, consensus reinforcement
      timeout: 300
      context7_required: true
      context7_packages: []
      triggers: []
      focus: []

    global-auggie:
      name: "Global Validator (Auggie)"
      engine: auggie-cli
      fallback_engine: pal-mcp
      prompt: "_generated/validators/global.md"
      wave: critical
      always_run: false
      blocking: false  # Non-blocking, additional AI perspective
      timeout: 600
      context7_required: false  # Auggie uses its own codebase context engine
      context7_packages: []
      triggers: ["*"]
      focus: []

    # Critical validators - cross-cutting (security/performance).
    security:
      name: "Security Validator"
      engine: codex-cli
      fallback_engine: pal-mcp
      prompt: "_generated/validators/security.md"
      wave: critical
      always_run: false
      blocking: true
      timeout: 300
      context7_required: true
      context7_packages: []
      triggers: ["*"]
      focus: [authentication, authorization, input-validation, sql-injection, xss, csrf, secrets]

    performance:
      name: "Performance Validator"
      engine: codex-cli
      fallback_engine: pal-mcp
      prompt: "_generated/validators/performance.md"
      wave: critical
      always_run: false
      blocking: true
      timeout: 300
      context7_required: true
      context7_packages: []
      triggers: ["*"]
      focus: [bundle-size, queries, n-plus-1, caching, memory-leaks]

    coderabbit:
      name: "CodeRabbit AI Review"
      engine: coderabbit-cli
      fallback_engine: pal-mcp
      prompt: "_generated/validators/coderabbit.md"
      wave: critical
      always_run: false
      blocking: false
      timeout: 600
      context7_required: false
      context7_packages: []
      triggers: ["*"]
      focus: []

  # Wave definitions (execution groups)
  # Waves define the order and behavior of validator execution
  waves:
    - name: critical
      execution: parallel
      continue_on_fail: false
      requires_previous_pass: false

    - name: comprehensive
      execution: parallel
      continue_on_fail: true
      requires_previous_pass: true

  # Artifact paths for evidence storage
  artifactPaths:
    bundleSummaryFile: "bundle-summary.md"
    implementationReportFile: "implementation-report.md"

  # Approval criteria (documentation only; logic uses `blocking` and the roster)
  approvalCriteria:
    criticalWave: "All blocking validators in the critical wave MUST approve."
    comprehensiveWave: "Triggered validators run in comprehensive wave; blocking validators MUST approve; non-blocking are advisory."
