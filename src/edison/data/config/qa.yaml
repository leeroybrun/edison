# QA and Validation Configuration
# Configuration for quality assurance, evidence tracking, and validation workflows

validation:
  # Validation presets - config-driven, pack-extensible
  # Presets define which validators to run and what evidence is required.
  # Projects/packs can override or add presets via config overlays.
  presets:
    # Quick preset: minimal validation for docs-only tasks
    quick:
      name: quick
      description: "Minimal validation for documentation-only changes"
      # Presets are additive on top of the always_run global validators and the
      # global baseline evidence (validation.evidence.requiredFiles).
      validators: []
      required_evidence: []

    # Standard preset: full validation for code changes
    standard:
      name: standard
      description: "Standard validation for code changes"
      validators:
        - security
        - performance
      required_evidence: []

    # Strict preset: comprehensive validation with all validators
    strict:
      name: strict
      description: "Comprehensive validation for critical changes"
      validators:
        - global-codex
        - global-claude
        - global-gemini
        - security
        - performance
        - coderabbit
      required_evidence: []

  # Preset inference rules - determine preset from file patterns
  # Higher priority rules take precedence when files match multiple patterns
  presetInference:
    rules:
      # Documentation-only changes -> quick preset
      - patterns:
          - "docs/**"
          - "*.md"
          - "**/*.md"
          - "LICENSE"
          - "LICENSE.*"
          - "CHANGELOG*"
        preset: quick
        priority: 10

      # Config/CI changes -> standard preset
      - patterns:
          - "pyproject.toml"
          - "package.json"
          - "*.yaml"
          - "*.yml"
          - ".github/**"
          - "Makefile"
          - "Dockerfile"
          - "docker-compose*.yml"
        preset: standard
        priority: 20

      # Source code changes -> standard preset
      - patterns:
          - "src/**"
          - "lib/**"
          - "app/**"
          - "apps/**"
          - "packages/**"
          - "*.py"
          - "*.ts"
          - "*.tsx"
          - "*.js"
          - "*.jsx"
          - "*.go"
          - "*.rs"
        preset: standard
        priority: 30

      # Test changes -> standard preset
      - patterns:
          - "tests/**"
          - "test/**"
          - "**/*_test.*"
          - "**/*.test.*"
          - "**/*.spec.*"
        preset: standard
        priority: 25

  # File context settings (used for validator triggering and rules routing).
  # These patterns exclude Edison-managed metadata/runtime artifacts so that
  # "modifiedFiles" reflects product/code changes rather than workflow noise.
  fileContext:
    ignorePatterns:
      - "{PROJECT_MANAGEMENT_DIR}/**"
      - "{PROJECT_CONFIG_DIR}/_generated/**"

  # Session ID to use for validation transactions when no active session exists
  # This is used as a fallback identifier for validation operations that
  # are not tied to a specific development session
  defaultSessionId: "validation-session"

  # Evidence collection settings
  evidence:
    # Canonical list of required evidence files (used by guards + prompts).
    # Templates should prefer {{fn:required_evidence_files}} / {{fn:evidence_file("<name>")}}
    # over hardcoded filenames.
    requiredFiles:
      - "command-type-check.txt"
      - "command-lint.txt"
      - "command-test.txt"
      - "command-build.txt"

    # File patterns that should be collected as evidence
    patterns:
      - "command-*.txt"
      - "command-coderabbit.txt"
      - "context7-*.md"
      - "context7-*.txt"
      - "validator-*-report.md"
    # Canonical mapping for evidence filenames referenced in prompts/guides.
    # Templates should prefer {{fn:evidence_file("<name>")}} over literals.
    files:
      type-check: "command-type-check.txt"
      lint: "command-lint.txt"
      test: "command-test.txt"
      build: "command-build.txt"

  # Policy cap for QA re-validation loops. Tools may use this to guide UX and
  # enforce limits in future guardrails.
  maxRounds: 3

  # Transaction settings
  transaction:
    # Maximum age of validation transactions before cleanup (hours)
    maxAgeHours: 24

    # Whether to auto-cleanup stale transactions
    autoCleanup: true
